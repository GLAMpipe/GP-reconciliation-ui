(function(t){function e(e){for(var r,o,i=e[0],s=e[1],u=e[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);l&&l(e);while(f.length)f.shift()();return c.push.apply(c,u||[]),n()}function n(){for(var t,e=0;e<c.length;e++){for(var n=c[e],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(c.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={app:0},c=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=s;c.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.error?n("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),n("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"info"}},[n("b-navbar-brand",{attrs:{href:""}},[t._v("Reconciliation matching for "),n("b",[t.project?n("span",[t._v(t._s(t.project.title)+": "+t._s(t.project.collection.title))]):t._e()])]),n("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),n("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[n("b-navbar-nav",{staticClass:"ml-auto"},[n("b-navbar-nav")],1)],1)],1),n("b-row",[n("b-col",{staticClass:"sideBar",attrs:{cols:"3"}},[n("b-card",[n("p",[t._v("Choose best match and click select.")]),n("div",[n("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1",value:"yes","unchecked-value":"no"},model:{value:t.show_only_non_matched,callback:function(e){t.show_only_non_matched=e},expression:"show_only_non_matched"}},[t._v(" Show only non-matched ")])],1),n("br"),t.project?n("table",{staticClass:"table b-table table-striped"},[n("tr",[n("td",[t._v("query field")]),n("td",[t._v(t._s(t.project.node.params.in_field))])]),n("tr",[n("td",[t._v("class limit")]),n("td",[t._v(t._s(t.project.node.settings.in_class_select))])])]):t._e()])],1),n("b-col",{attrs:{cols:"9"}},[n("DBDataTable",{ref:"table",attrs:{project:t.project,show_only_non_matched:t.show_only_non_matched}})],1)],1)],1)},c=[],o=n("1da1"),i=(n("96cf"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"data"},[t.project&&t.project.node.settings?[t._v(" matched: "+t._s(t.stats.total-t.stats.non_matched)+"/"+t._s(t.stats.total)+" "),t.data.length&&0==t.stats.non_matched?n("div",{staticClass:"alert alert-success"},[t._v("All done!")]):t._e(),n("b-table",{attrs:{striped:"",hover:"",items:t.data,fields:t.fields},scopedSlots:t._u([{key:"cell("+t.suggestions_field+")",fn:function(e){return[n("div",{domProps:{innerHTML:t._s(t.formatReconciliationResult(e.value,e.item))}})]}},{key:"cell("+t.match_field+")",fn:function(e){return[n("div",{domProps:{innerHTML:t._s(t.formatReconciliationMatch(e.value,e.item))}})]}}],null,!0)})]:n("div",[n("div",{staticClass:"alert alert-warning"},[t._v("Did not find reconciliation data! Did you run reconciliation node?")])])],2)}),s=[],u=n("b85c"),l=(n("99af"),n("ac1f"),n("466d"),n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("841c"),n("7db0"),n("1276"),n("5319"),n("bc3a")),d=n.n(l),f={};f.getProject=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,n,r,a,c,o,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=new URLSearchParams(window.location.search),n=e.get("node"),t.next=4,d.a.get("/api/v2/nodes/".concat(n));case 4:return r=t.sent,a=r.data.project,t.next=8,d.a.get("/api/v2/projects/".concat(a));case 8:return c=t.sent,o=c.data.nodes.find((function(t){return t._id===n})),i=c.data.collections.find((function(t){return t.name===o.collection})),s={title:c.data.title,node:o,collection:i},t.abrupt("return",s);case 13:case"end":return t.stop()}}),t)}))),f.getData=function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n,r){var a,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a='{"$or":[{"'.concat(r,'": {"$exists":false}}, {"').concat(r,'":""}]}'),"yes"!==n){t.next=7;break}return t.next=4,d.a.get("/api/v2/collections/".concat(e,"/docs?mongoquery=").concat(a));case 4:c=t.sent,t.next=10;break;case 7:return t.next=9,d.a.get("/api/v2/collections/".concat(e,"/docs"));case 9:c=t.sent;case 10:return t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),f.getStats=function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n){var r,a,c,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r='{"$or":[{"'.concat(n,'": {"$exists":false}}, {"').concat(n,'":""}]}'),t.next=3,d.a.get("/api/v2/collections/".concat(e,"/count"));case 3:return a=t.sent,t.next=6,d.a.get("/api/v2/collections/".concat(e,"/count?mongoquery=").concat(r));case 6:return c=t.sent,o={total:a.data.count,non_matched:c.data.count},t.abrupt("return",o);case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),f.setData=function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n,r){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,d.a.put("/api/v2/collections/".concat(e,"/docs/").concat(n),r);case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),f.getURLQueryParamsAsString=function(){var t=document.URL.split("?");return 2==t.length?t[1].replace(/\?/g,""):""};var p=f,h={name:"DBDataTable",props:["show_only_non_matched","project"],data:function(){return{stats:{total:-1,unmatched:0},data:[],fields:[],suggestions_field:"",match_field:""}},methods:{formatReconciliationResult:function(t,e){var n="<table>";if(e[this.match_field])return'<button class="btn btn-outline-primary" onclick="window.table.setSelection(\''.concat(e._id,"', '')\">Change selection </button> (").concat(t.result.length," suggestions)");if(t.result){var r,a=Object(u["a"])(t.result);try{for(a.s();!(r=a.n()).done;){var c=r.value;if(c.match)n+='<b class="text-info">'.concat(c.name," ").concat(c.id,"</b>");else{var o="".concat(c.score);100==c.score&&(o="<b>".concat(c.score,"</b>")),n+="<tr><td><b>".concat(c.name,"</b></td><td> ").concat(c.id," </td>"),n+="<td>".concat(o);var i,s=Object(u["a"])(c.features);try{for(s.s();!(i=s.n()).done;){var l=i.value;n+="<div>".concat(l.id," : ").concat(l.value,"</div>")}}catch(d){s.e(d)}finally{s.f()}n+="</td><td><button onclick=\"window.table.setSelection('".concat(e._id,"', '").concat(c.id,'\')" class="btn btn-primary" type="button">select</button></td></tr>')}}}catch(d){a.e(d)}finally{a.f()}}return n+"</table>"},formatReconciliationMatch:function(t,e){return this.pickWID(t,e)},pickWID:function(t,e){var n="";if(e[this.suggestions_field]&&e[this.suggestions_field].result){if("none"===t)return"no match found";var r,a=Object(u["a"])(e[this.suggestions_field].result);try{for(a.s();!(r=a.n()).done;){var c=r.value;c.id==t&&(n+='<b class="text-info">'.concat(c.name,' (<a href="">').concat(c.id,"</a>)</b>"))}}catch(o){a.e(o)}finally{a.f()}}return n||(n="<button onclick=\"window.table.setSelection('".concat(e._id,"', 'none')\" class=\"btn btn-outline-primary\">no match found</button>")),n},setSelection:function(t,e){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a={},a[n.match_field]=e,r.next=4,p.setData(n.project.collection.name,t,a);case 4:return r.next=6,n.getData();case 6:case"end":return r.stop()}}),r)})))()},getData:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p.getData(t.project.collection.name,t.show_only_non_matched,t.match_field);case 2:return n=e.sent,t.data=n.data.data,e.next=6,p.getStats(t.project.collection.name,t.match_field);case 6:t.stats=e.sent;case 7:case"end":return e.stop()}}),e)})))()}},watch:{show_only_non_matched:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getData();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),project:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.project.node){t.next=6;break}return this.suggestions_field=this.project.node.params.out_result,this.match_field=this.project.node.params.out_match,this.fields=this.fields.concat([this.project.node.params.in_field,this.suggestions_field,this.match_field]),t.next=6,this.getData();case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:window.table=this;case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},b=h,m=n("2877"),v=Object(m["a"])(b,i,s,!1,null,null,null),_=v.exports,g=(n("f9e3"),n("2dd8"),{name:"App",components:{DBDataTable:_},data:function(){return{project:null,show_only_non_matched:!1,error:null}},mounted:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,p.getProject();case 2:this.project=t.sent;case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}),w=g,y=Object(m["a"])(w,a,c,!1,null,null,null),j=y.exports,x=n("5f5b"),k=n("b1e0"),R=n("67b0");r["default"].use(x["a"]),r["default"].use(k["a"]),r["default"].use(R["a"]),r["default"].config.productionTip=!1,new r["default"]({render:function(t){return t(j)}}).$mount("#app")}});
//# sourceMappingURL=app.f23d7d59.js.map